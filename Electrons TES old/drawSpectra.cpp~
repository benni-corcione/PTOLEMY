#include <iostream>
#include <fstream>
#include <sstream>
#include <string>
#include <stdlib.h>

#include "TFile.h"
#include "TF1.h"
#include "TTree.h"
#include "TString.h"
#include "TH2D.h"
#include "TMath.h"
#include "TAxis.h"
#include "pshape_functions.h"
#include "graphics.h"
#include "AndCommon.h"
#include "TLatex.h"
 
//variabili da modificare di volta in volta: range_min, range_max, fit_min, fit_max, nbins

int main(void){ 

  //apertura file con il tree
  TFile run1("~/Documents/phd/PTOLEMY/CD data/data/root/CD188/conteggi/100V/CD188_100V_tree.root");
  TTree *tree1 = (TTree*)run1.Get("tree");
  Long64_t nentries1 = tree1->GetEntries();

  TFile run2("~/Documents/phd/PTOLEMY/CD data/data/root/CD204/B60_post_cond3_moku/100V/CD204_100V_tree.root");
  TTree *tree2 = (TTree*)run2.Get("tree");
  Long64_t nentries2 = tree2->GetEntries();
   
  //preparazione per la lettura del tree in amp o charge
  float charge1;
  float charge2;
  int nbins2 = 200;
  int nbins1 = 100;
  tree1->SetBranchAddress("amp", &charge1);
  tree2->SetBranchAddress("amp", &charge2);

  Settings settings;
  float hmax = 1.;
  float hmin = 0.;
  float binsize_cha1 = settings.Binsize((hmax-hmin)/nbins1);
  float binsize_cha2 = settings.Binsize((hmax-hmin)/nbins2); 

  
  //creazione istogramma e lettura del tree
  TH1F* h1= new TH1F("h1", "Charge", nbins1, hmin, hmax);
  TH1F* h2= new TH1F("h2", "Charge", nbins2, hmin, hmax);
 
  for(int iEntry=0; iEntry<nentries1; iEntry++){
    tree1->GetEntry(iEntry);
    h1->Fill(charge1);
  }

  for(int iEntry=0; iEntry<nentries2; iEntry++){
    tree2->GetEntry(iEntry);
    h2->Fill(charge2);
  }
  
  //tela
  TCanvas* c = new TCanvas("c","",1400,1200);
  settings.Margin(c);
  settings.general_style();
  c->SetLeftMargin(0.2);
  c->cd();
 
  TPad *pad_new = new TPad("pad_new" ,"",0,0,1,1);
  TH2D *h2_axes_new = new TH2D( "axes_new", "", 10, 0, 0.7, 10, 0., 1000 );
  h2_axes_new->SetXTitle( "Amplitude [V]" );
  h2_axes_new->SetYTitle("Counts");
  h2_axes_new->GetYaxis()->SetNdivisions(505);
  h2_axes_new->GetYaxis()->SetTitleOffset(1.3);
  h2_axes_new->GetYaxis()->SetAxisColor (kBlack);
  h2_axes_new->GetYaxis()->SetTitleColor(kBlack);
  h2_axes_new->GetYaxis()->SetLabelColor(kBlack);
  h2_axes_new->GetXaxis()->SetLabelSize(0.048);
  h2_axes_new->GetXaxis()->SetTitleSize(0.048);
  h2_axes_new->GetYaxis()->SetLabelSize(0.048);
  h2_axes_new->GetYaxis()->SetTitleSize(0.048);
  //h2_axes_new->SetTitle("101 eV");
  
  
  
  //gStyle->SetTitleFontSize(0.06);

 
  h2->SetLineColor(46);
  h2->SetLineWidth(3);
  h2->SetFillStyle(3004);
  h1->SetFillStyle(3004);
  h1->SetFillColor(kBlack);
  h2->SetFillColor(46);
  pad_new->SetLeftMargin(0.115);
  pad_new->SetTopMargin(0.115);
  pad_new->Draw();
  pad_new->cd();
  h2_axes_new->Draw("");
  h2->Draw("same");

  TLatex* label2 = new TLatex( 0.02, 1020, "T60, CNTs: 1 mm^{2}" );
  label2->SetTextSize( 0.048 );
  label2->SetTextColor(46);
  label2->Draw("same");

  
  TLatex* label1 = new TLatex(  0.02, 1080, "T100a, CNTs: 9 mm^{2}");
  label1->SetTextSize( 0.048 );
  label1->SetTextColor(kBlack);
  label1->Draw("same");

  
  TLatex* labeltitle = new TLatex( 0.28, 930, "#it{V}_{cnt} = 100 V" );
  labeltitle->SetTextSize( 0.052 );
  labeltitle->SetTextColor(46);
  //labeltitle->Draw("same");
  
  TLatex* label3 = new TLatex( 0.53, 1020, "#bf{E_{e} = 96 eV}" );
  label3->SetTextSize( 0.052 );
  label3->SetTextColor(kBlack);
  label3->Draw("same");
  
  
  TPad *pad_old  = new TPad("pad_old" ,"",0.25,0.35,0.79,0.88);
  pad_old->SetFillStyle(4000); //will be transparent
  pad_old->SetTopMargin(0.01);
  pad_old->SetBottomMargin(0.25);
  pad_old->SetLeftMargin(0.25);
  pad_old->SetRightMargin(0.06);
  pad_old->Draw();
  pad_old->cd();

  
  TH2D* h2_axes_old = new TH2D("axes_old", "", 10, 0, 1., 10., 0, 228 );
  h2_axes_old->GetXaxis()->SetNdivisions(505);
  h2_axes_old->GetXaxis()->SetLabelSize(0.085);
  h2_axes_old->GetXaxis()->SetTitleOffset(1.);
  h2_axes_old->GetXaxis()->SetTitleSize(0.085);
  h2_axes_old->GetYaxis()->SetNdivisions(505);
  h2_axes_old->GetYaxis()->SetLabelSize(0.085);
  h2_axes_old->GetYaxis()->SetTitleOffset(1.1);
  h2_axes_old->GetYaxis()->SetTitleSize(0.085);
  h2_axes_old->SetXTitle( "Amplitude [V]" );
  h2_axes_old->SetYTitle("Counts");
  h2_axes_old->Draw();
  
  h1->SetLineColor(kBlack);
  h1->SetLineWidth(3);
 
  h1->Draw("same");



 
  
  c->SaveAs("/Users/massimo/Documents/phd/PTOLEMY/Articoli/Firmati/new article/graphs/spectra_96eV.pdf");

 
  delete(h1);
  delete(h2);
  delete(c);
  
  return(0);
}

